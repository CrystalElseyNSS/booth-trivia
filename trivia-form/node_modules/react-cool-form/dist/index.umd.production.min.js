!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).ReactCoolForm={},e.React)}(this,(function(e,r){"use strict";function t(){return(t=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var n=Object.prototype.hasOwnProperty;function u(e,r){var t,i;if(e===r)return!0;if(e&&r&&(t=e.constructor)===r.constructor){if(t===Date)return e.getTime()===r.getTime();if(t===RegExp)return e.toString()===r.toString();if(t===Array){if((i=e.length)===r.length)for(;i--&&u(e[i],r[i]););return-1===i}if(!t||"object"==typeof e){for(t in i=0,e){if(n.call(e,t)&&++i&&!n.call(r,t))return!1;if(!(t in r)||!u(e[t],r[t]))return!1}return Object.keys(r).length===i}}return e!=e&&r!=r}var i=function(e){var t=r.useRef(e);return r.useEffect((function(){t.current=e})),t},c=function(e){return e.reduce((function(e,r){return e[r]=!0,e}),{})},a=function(e){return null!==e&&"object"==typeof e},o=function(e){return e instanceof FileList},l=function e(r){if(!a(r)||o(r))return r;if(r instanceof Date)return new Date(r.getTime());if(Array.isArray(r))return r.map((function(r){return e(r)}));if(a(r))return Object.keys(r).reduce((function(t,n){return t[n]=e(r[n]),t}),{});throw new Error("Unable to clone object.")},s=function e(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];return t.reduce((function(r,t){return Object.keys(t).forEach((function(n){var u=r[n],i=t[n];Array.isArray(u)&&Array.isArray(i)?r[n]=[].concat(u,i):a(u)&&a(i)?r[n]=e(u,i):r[n]=i})),r}),{})},f=function(e){return!Array.isArray(e)&&a(e)},d=function(e){return void 0===e},v=function e(r,t){return!f(r)||r instanceof Date?t?r:void 0:Object.keys(r).reduce((function(n,u){var i=e(r[u],t[u]||!1);return d(i)?delete n[u]:n[u]=i,n}),{})},y=function(e,r,t){if(!f(e)||!r)return t;var n=r.split(/[,[\].]+?/).filter(Boolean).reduce((function(e,r){return(e||{})[r]}),e);return d(n)?t:n},b=function(e){return"checkbox"===e.type},h=function(e){return f(e)&&!Object.keys(e).length},m=function(e){return/INPUT|TEXTAREA|SELECT/.test(e.tagName)},p=function(e){return"file"===e.type},g=function(e){return"function"==typeof e},k=function(e){return"select-multiple"===e.type},C=function(e){return"radio"===e.type},E=function(e){return(window.requestIdleCallback||function(e){var r=Date.now();return setTimeout((function(){return e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-r))}})}),1)})(e,{timeout:2e3})},A=function(e,r,t,n){if(void 0===n&&(n=!1),!f(e))throw new TypeError("Expected an object.");var u=String(r).split(/[.[\]]+/).filter(Boolean),i=n?l(e):e;return u.slice(0,-1).reduce((function(e,r,t){if(a(e[r]))return e[r];var n=Number(u[t+1]);return e[r]=Number.isInteger(n)&&n>=0?[]:{},e[r]}),i)[u[u.length-1]||""]=t,i},w=function(e,r){return r.reduce((function(e,r){return e=A(e,r,!0,!0)}),e)},O=function(e,r,t){if(void 0===t&&(t=!1),!f(e))throw new TypeError("Expected an object.");var n=t?l(e):e,u=n;if(u.hasOwnProperty(r))return delete u[r],n;if(!d(y(u,r))){for(var i=r.split("."),c=i.pop();i.length&&"\\"===i[i.length-1].slice(-1);)c=i.pop().slice(0,-1)+"."+c;for(;i.length;)u=u[r=i.shift()];delete u[c]}return n},j=function(e,n){var c=r.useReducer((function(e){return e+1}),0)[1],a=r.useRef(e),o=r.useRef({}),l=i(n||function(){}),s=r.useCallback((function(e,r,n){var i=void 0===n?{}:n,s=i.fieldPath,d=i.shouldUpdate,v=void 0===d||d,b=e.split(".")[0];if(b){if("values"===b||!u(y(a.current,e),r)){var m=A(a.current,e,r,!0),p=m.errors,g=m.dirtyFields,k=m.isDirty,C=m.isValid,E=m.submitCount,w="dirtyFields"===b?!!function e(r,t){void 0===t&&(t=[]);for(var n=0,u=Object.values(r);n<u.length;n++){var i=u[n];if(!0===i)return t.push(i),t;f(i)&&e(i,t)}return t}(g).length:k,O="errors"===b?h(p):C,j="isSubmitting"===b&&r?E+=1:E;a.current=t({},m,{isDirty:w,isValid:O,submitCount:j}),e=s||e,v&&(Object.keys(o.current).some((function(r){return e.startsWith(r)||r.startsWith(e)}))||o.current.isDirty&&w!==k||o.current.isValid&&O!==C)&&(c(),l.current(a.current))}}else u(a.current,r)||(a.current=r,c(),l.current(a.current))}),[l]),d=r.useCallback((function(e){o.current[e]=!0}),[]);return{stateRef:a,setStateRef:s,setUsedStateRef:d}},F="undefined"==typeof window?r.useEffect:r.useLayoutEffect;e.get=y,e.set=A,e.unset=O,e.useForm=function(e){var n=e.defaultValues,u=void 0===n?{}:n,a=e.validate,l=e.validateOnChange,R=void 0===l||l,S=e.validateOnBlur,V=void 0===S||S,D=e.removeUnmountedField,T=void 0===D||D,L=e.ignoreFields,P=void 0===L?[]:L,x=e.onReset,N=e.onSubmit,U=e.onError,B=e.debug,I=r.useRef(!0),M=r.useRef(null),q=r.useRef({}),W=r.useRef({}),_=r.useRef({}),X=r.useRef(c(P)),z=r.useRef(),G=i(a),H=r.useRef({}),J=i(x||function(){}),K=i(N||function(){}),Q=i(U||function(){}),Y=r.useRef(u),Z=r.useRef({values:Y.current,touched:{},errors:{},isDirty:!1,dirtyFields:{},isValidating:!1,isValid:!0,isSubmitting:!1,isSubmitted:!1,submitCount:0}),$=j(Z.current,B),ee=$.stateRef,re=$.setStateRef,te=$.setUsedStateRef,ne=r.useCallback((function(e){return Array.from(e.querySelectorAll("input,textarea,select")).filter((function(e){var r=e,t=r.type,n=r.name,u=r.dataset;return!/image|submit|reset/.test(t)&&(!!n&&(_.current[n]||!(u.rcfIgnore||X.current[n])))})).reduce((function(e,r){var n=r,u=n.name;return e[u]=t({},e[u],{field:r}),(b(n)||C(n))&&(e[u].options=e[u].options?[].concat(e[u].options,[r]):[r]),e}),{})}),[]),ue=r.useCallback((function(){return Object.keys(t({},q.current,_.current))}),[]),ie=r.useCallback((function(e,r,t,n){re(e,O(t,n,!0),{fieldPath:r})}),[re]),ce=r.useCallback((function(e){return function(r){if(null!=r&&r.name&&!_.current[r.name]&&!X.current[r.name])if(g(e))H.current[r.name]=e;else{var t=e.validate,n=function(e,r){if(null==e)return{};var t,n,u={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||(u[t]=e[t]);return u}(e,["validate"]);t&&(H.current[r.name]=t),W.current[r.name]=n}}}),[]),ae=r.useCallback((function(e){var r,t=q.current[e],n=t.field,u=t.options,i=n.value;if("INPUT"===n.tagName){var c,a;if(null!=(c=W.current[e])&&c.valueAsNumber)return i=n.valueAsNumber;if(null!=(a=W.current[e])&&a.valueAsDate)return i=n.valueAsDate}if((function(e){return"number"===e.type}(n)||function(e){return"range"===e.type}(n))&&(i=n.valueAsNumber||""),b(n))if(u){var o=u;i=u.length>1?o.filter((function(e){return e.checked})).map((function(e){return e.value})):o[0].checked}else{var l=y(ee.current.values,n.name);Array.isArray(l)?(l=new Set(l),n.checked?l.add(i):l.delete(i),i=Array.from(l)):i=n.checked}return C(n)&&u&&(i=(null==(r=u.find((function(e){return e.checked})))?void 0:r.value)||""),k(n)&&!u&&(i=Array.from(n.options).filter((function(e){return e.selected})).map((function(e){return e.value}))),p(n)&&(i=n.files),i}),[ee]),oe=r.useCallback((function(e,r){if(q.current[e]&&!_.current[e]){var t=q.current[e],n=t.field,u=t.options;if(b(n)){var i=u;i.length>1?i.forEach((function(e){e.checked=Array.isArray(r)?r.includes(e.value):!!r})):i[0].checked=!!r}else C(n)?u.forEach((function(e){e.checked=e.value===r})):k(n)&&Array.isArray(r)?Array.from(n.options).forEach((function(e){e.selected=!!r.includes(e.value)})):p(n)?(o(r)&&(n.files=r),r||(n.value="")):n.value=null!=r?r:""}}),[]),le=r.useCallback((function(e,r){d(y(Z.current.values,e))&&(Z.current.values=A(Z.current.values,e,r,!0),re("values."+e,y(Z.current.values,e),{shouldUpdate:!I.current}))}),[re]),se=r.useCallback((function(e,r){return void 0===r&&(r=!1),Object.values(q.current).forEach((function(t){var n=t.field.name;if(!_.current[n]){var u=y(e,n);if(d(u)||oe(n,u),r){var i=y(Y.current,n);le(n,d(i)?ae(n):i)}}}))}),[ae,le,oe]),fe=r.useCallback((function(e,r){var t,n=void 0===r?{}:r,u=n.target,i=n.watch,c=void 0===i||i,a=n.filterUntouchedError,o=void 0===a||a,l=function(e){return u?u+"."+e:e},s=function(e,r){return c&&o&&e.startsWith("errors")&&r&&!h(r)?(e=e.replace("errors","touched"),te(e),v(r,y(ee.current,e))):r};if(Array.isArray(e))t=e.map((function(e){return e=l(e),c&&te(e),s(e,y(ee.current,e))}));else if(f(e)){var d=e;t=Object.keys(d).reduce((function(r,t){return e=l(d[t]),c&&te(e),r[t]=s(e,y(ee.current,e)),r}),{})}else e=l(e),c&&te(e),t=s(e,y(ee.current,e));return t}),[te,ee]),de=r.useCallback((function(e){re("errors",(g(e)?e(ee.current.errors):e)||{})}),[re,ee]),ve=r.useCallback((function(e,r){(r=g(r)?r(y(ee.current.errors,e)):r)?re("errors."+e,r):ie("errors","errors."+e,ee.current.errors,e)}),[ie,re,ee]),ye=r.useCallback((function(e){var r;return null==(r=q.current[e])?void 0:r.field.validationMessage}),[]),be=r.useCallback((function(){return Object.keys(q.current).reduce((function(e,r){var n=ye(r);return e=t({},e,n?A({},r,n):{})}),{})}),[ye]),he=r.useCallback((async function(e){if(H.current[e])try{return await H.current[e](y(ee.current.values,e),ee.current.values)}catch(e){throw e}}),[ee]),me=r.useCallback((function(){var e=Object.keys(H.current).map((function(e){return he(e)}));return Promise.all(e).then((function(e){return Object.keys(H.current).reduce((function(r,n,u){return r=t({},r,e[u]?A({},n,e[u]):{})}),{})}))}),[he]),pe=r.useCallback((async function(e){if(!G.current)return e?void 0:{};try{var r=await G.current(ee.current.values);return e?y(r,e):f(r)?r:{}}catch(e){throw e}}),[G,ee]),ge=r.useCallback((async function(e){re("isValidating",!0);try{var r=await pe(e)||await he(e)||ye(e);return ve(e,r),re("isValidating",!1),r}catch(e){return e}}),[ye,he,pe,ve,re]),ke=r.useCallback((function(e){return E((function(){return ge(e)}))}),[ge]),Ce=r.useCallback((function(){return re("isValidating",!0),Promise.all([be(),me(),pe()]).then((function(e){var r=s.apply(void 0,e);return de(r),re("isValidating",!1),r}))}),[be,me,pe,de,re]),Ee=r.useCallback((function(){return E(Ce)}),[Ce]),Ae=r.useCallback((function(e){y(ee.current.values,e)!==y(Z.current.values,e)?re("dirtyFields."+e,!0):ie("dirtyFields","dirtyFields."+e,ee.current.dirtyFields,e)}),[ie,re,ee]),we=r.useCallback((function(e,r){void 0===r&&(r=V),re("touched."+e,!0),r&&ke(e)}),[re,ke,V]),Oe=r.useCallback((function(e){return we(e,R?e!==z.current:void 0)}),[we,R]),je=r.useCallback((function(e,r){var t=void 0===r?{}:r,n=t.shouldValidate,u=void 0===n?R:n,i=t.touchedFields,c=void 0===i?[]:i,a=t.dirtyFields,o=void 0===a?[]:a;e=g(e)?e(ee.current.values):e,re("values",e),se(e),c.length&&re("touched",w(ee.current.touched,g(c)?c(ue()):c)),o.length&&re("dirtyFields",w(ee.current.dirtyFields,g(o)?o(ue()):o)),u&&Ee()}),[ue,se,re,ee,Ee,R]),Fe=r.useCallback((function(e,r,t){var n=void 0===t?{}:t,u=n.shouldValidate,i=void 0===u?R:u,c=n.shouldTouched,a=void 0===c||c,o=n.shouldDirty,l=void 0===o||o;r=g(r)?r(y(ee.current.values,e)):r,d(r)?ie("values","values."+e,ee.current.values,e):re("values."+e,r),oe(e,r),a&&we(e,!1),l&&Ae(e),i&&ke(e)}),[ie,Ae,we,oe,re,ee,ke,R]),Re=r.useCallback((function(){return{formState:ee.current,setErrors:de,setFieldError:ve,setValues:je,setFieldValue:Fe,validateForm:Ce,validateField:ge,reset:Se,submit:Ve}}),[Se,de,ve,Fe,je,ee,Ve,ge,Ce]),Se=r.useCallback((function(e,r,n){null==n||n.preventDefault(),null==n||n.stopPropagation();var u=t({},ee.current),i=c(r||[]);Object.keys(u).forEach((function(r){i[r]||("values"===r?(e=(g(e)?e(ee.current.values):e)||Z.current.values,u[r]=e,se(e)):u[r]=Z.current[r])})),re("",u),J.current(u.values,Re(),n)}),[Re,J,se,re,ee]),Ve=r.useCallback((async function(e){null==e||e.preventDefault(),null==e||e.stopPropagation();var r=ee.current,t=r.touched,n=r.values;re("touched",w(t,ue())),re("isSubmitting",!0);try{var u=await Ce();return h(u)?(await K.current(n,Re(),e),re("isSubmitted",!0),{values:n}):(Q.current(u,Re(),e),{errors:u})}catch(e){throw e}finally{re("isSubmitting",!1)}}),[ue,Re,Q,K,re,ee,Ce]),De=r.useCallback((function(e,r){re("values."+e,r),Ae(e),R&&ke(e)}),[Ae,re,ke,R]),Te=r.useCallback((function(e,r){var t,n=void 0===r?{}:r,u=n.validate,i=n.value,c=n.defaultValue,a=n.parse,o=n.format,l=n.onChange,s=n.onBlur;if(e){_.current[e]=!0,u&&(H.current[e]=u);var f=y(Y.current,e);return c=d(f)?c:f,d(c)||le(e,c),i=d(i)?fe("values."+e):i,i=null!=(t=o?o(i):i)?t:"",{name:e,value:i,onChange:function(r){var t=r.nativeEvent instanceof Event&&m(r.target)?ae(e):r;De(e,a?a(t):t),l&&l(r,t),z.current=e},onBlur:function(r){Oe(e),s&&s(r),z.current=void 0}}}}),[ae,fe,De,le,Oe]);return F((function(){M.current&&(q.current=ne(M.current),se(Z.current.values,!0),I.current=!1)}),[ne,se]),r.useEffect((function(){if(!M.current)return function(){return null};var e=function(e){var r=e.target.name;if(r&&q.current[r]&&!_.current[r]){var t,n=null==(t=W.current[r])?void 0:t.parse,u=ae(r);De(r,n?n(u):u),z.current=r}},r=function(e){var r=e.target;if(m(r)){var t=r.name;q.current[t]&&!_.current[t]&&(Oe(t),z.current=void 0)}},t=function(e){return Ve(e)},n=function(e){return Se(null,null,e)},u=M.current;u.addEventListener("input",e),u.addEventListener("focusout",r),u.addEventListener("submit",t),u.addEventListener("reset",n);var i=new MutationObserver((function(e){if("childList"===e[0].type){var r=ne(u),t=ee.current.values;T&&Object.keys(q.current).forEach((function(e){r[e]||(ie("values","values."+e,ee.current.values,e),ie("touched","touched."+e,ee.current.touched,e),ie("dirtyFields","dirtyFields."+e,ee.current.dirtyFields,e),ie("errors","errors."+e,ee.current.errors,e),Z.current.values=O(Z.current.values,e,!0),delete W.current[e],delete H.current[e],delete _.current[e])}));var n=!1;Object.keys(r).forEach((function(e){if(!q.current[e]&&!_.current[e]){var r=y(Y.current,e);d(r)||(t=A(t,e,r,!0)),n=!0}})),q.current=r,n&&se(t,!0)}}));return i.observe(u,{childList:!0,subtree:!0}),function(){u.removeEventListener("input",e),u.removeEventListener("focusout",r),u.removeEventListener("submit",t),u.removeEventListener("reset",n),i.disconnect()}}),[ne,ae,De,ie,T,Se,se,Oe,ee,Ve]),{form:M,field:ce,getState:fe,setErrors:de,setFieldError:ve,setValues:je,setFieldValue:Fe,validateForm:Ce,validateField:ge,reset:Se,submit:Ve,controller:Te}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.production.min.js.map
